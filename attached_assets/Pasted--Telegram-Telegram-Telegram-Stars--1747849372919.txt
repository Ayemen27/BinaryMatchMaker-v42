لإنشاء بوت في Telegram يدعم الدفع باستخدام عملة "نجوم Telegram" (Telegram Stars) ويعرض نافذة منبثقة داخل التطبيق (وليس رسالة تقليدية)، يمكنك الاستفادة من ميزة تطبيقات Telegram المصغّرة (Mini Apps).  تتيح هذه الميزة للمستخدمين التفاعل مع واجهات ويب مدمجة داخل Telegram، مما يوفر تجربة مستخدم سلسة ومتكاملة. 


---

🧩 ما هي تطبيقات Telegram المصغّرة (Mini Apps)؟

تطبيقات Mini Apps هي تطبيقات ويب تُفتح داخل Telegram دون الحاجة لمغادرة التطبيق.  تُستخدم هذه التطبيقات لعرض واجهات تفاعلية، مثل نماذج الطلبات، الألعاب، أو عمليات الدفع.  عند دمجها مع نظام الدفع عبر نجوم Telegram، يمكن للمستخدمين إجراء عمليات شراء داخل التطبيق بسهولة. 


---

🛠️ خطوات إنشاء بوت يدعم الدفع عبر نجوم Telegram مع نافذة منبثقة

1. إنشاء بوت جديد

افتح محادثة مع @BotFather في Telegram.

استخدم الأمر /newbot واتبع التعليمات لإنشاء بوت جديد.

احصل على رمز التوكن (Token) الخاص بالبوت، ستحتاجه لاحقًا. 


2. إعداد تطبيق الويب (Mini App)

قم بإنشاء تطبيق ويب باستخدام HTML/CSS/JavaScript أو أي إطار عمل تفضله (مثل React أو Vue).

أضف مكتبة Telegram Web Apps SDK إلى مشروعك: 


<script src="https://telegram.org/js/telegram-web-app.js"></script>



استخدم الدوال المتاحة مثل Telegram.WebApp.ready() لإعلام Telegram بأن التطبيق جاهز للعرض. 


3. دمج نظام الدفع عبر نجوم Telegram

عند رغبتك في إرسال فاتورة للمستخدم، استخدم طريقة sendInvoice من Telegram Bot API.

حدد العملة كـ "XTR" لتمكين الدفع عبر نجوم Telegram.

نظرًا لأنك تبيع منتجات رقمية، لا حاجة لتوفير provider_token. 


مثال بلغة Python باستخدام مكتبة python-telegram-bot:

from telegram import LabeledPrice

await context.bot.send_invoice(
    chat_id=update.effective_chat.id,
    title="شراء منتج رقمي",
    description="وصف المنتج الرقمي",
    payload="معرّف_الطلب",
    provider_token="",  # لا حاجة لمزود دفع لمنتجات رقمية
    currency="XTR",
    prices=[LabeledPrice("المنتج", 10000)],  # السعر بوحدة السنت (10000 = 100 XTR)
    start_parameter="start",
    is_flexible=False
)



4. نشر تطبيق الويب وربطه بالبوت

استضف تطبيق الويب الخاص بك على خادم أو خدمة استضافة (مثل Vercel أو Netlify).

في محادثة مع @BotFather، استخدم الأمر /mybots، ثم اختر البوت الخاص بك.

اذهب إلى "Bot Settings" > "Configure Web Apps" وأضف رابط تطبيق الويب الخاص بك. 


5. اختبار البوت

ابدأ محادثة مع البوت في Telegram.

استخدم الأمر /start أو أي أمر قمت بتحديده لفتح تطبيق الويب.

تأكد من أن نافذة تطبيق الويب تُفتح داخل Telegram وتعمل بشكل صحيح.

اختبر عملية الدفع عبر نجوم Telegram وتأكد من إتمامها بنجاح. 



---

📦 مشروع جاهز كمثال

يمكنك الرجوع إلى هذا المشروع المفتوح المصدر على GitHub الذي يوضح كيفية إنشاء بوت يدعم الدفع عبر نجوم Telegram: 

🔗 xep1x/telegram-bot-payments

هذا المشروع يستخدم لغة Python ويوفر مثالًا عمليًا على إرسال الفواتير ومعالجة المدفوعات. 


---

🎥 فيديو توضيحي

لمزيد من الفهم العملي، يمكنك مشاهدة هذا الفيديو الذي يشرح كيفية بناء تطبيق مصغّر في Telegram يدعم الدفع عبر نجوم Telegram: 


---

إذا كنت بحاجة إلى مساعدة إضافية في تنفيذ أي من الخطوات أو تخصيص البوت وفقًا لاحتياجاتك، فلا تتردد في طرح المزيد من الأسئلة!

