# دليل النسخ الاحتياطي واستعادة قاعدة بيانات Supabase

هذا الدليل يشرح كيفية إنشاء نسخة احتياطية من قاعدة بيانات Supabase واستعادتها عند نقل المشروع إلى بيئة جديدة.

## النسخ الاحتياطي

النظام يقوم تلقائيًا بإنشاء نسخ احتياطية من قاعدة البيانات كل 5 دقائق. يمكنك أيضًا إنشاء نسخة احتياطية يدويًا عن طريق تنفيذ هذا الأمر:

```bash
node scripts/backup-database.js
```

هذا سيقوم بإنشاء ملفين:
1. ملف JSON في مجلد `backups/` يحتوي على نسخة كاملة من قاعدة البيانات بما في ذلك البيانات (مثال: `backup-2025-05-19T21-58-06-963Z.json`)
2. ملف معلومات المخطط للجداول والعلاقات

## استعادة قاعدة البيانات

### استعادة نسخة كاملة

لاستعادة نسخة كاملة من قاعدة البيانات بما في ذلك البيانات:

```bash
node scripts/restore-database.js backup-2025-05-19T21-58-06-963Z.json
```

حيث `backup-2025-05-19T21-58-06-963Z.json` هو اسم ملف النسخة الاحتياطية الذي ترغب في استعادته.

## إعداد Supabase

يستخدم المشروع قاعدة بيانات Supabase السحابية. للإعداد:

1. قم بإنشاء حساب على [Supabase](https://supabase.com/) وأنشئ مشروعًا جديدًا
2. احصل على رابط الاتصال بقاعدة البيانات من خلال الضغط على "Connection String" تحت قسم "Settings" → "Database"
3. استخدم رابط مجمع المعاملات (Transaction Pooler) للاتصال بقاعدة البيانات
4. أضف المتغيرات البيئية التالية إلى ملف `.env`:

```
DATABASE_URL=postgresql://postgres.[PROJECT_REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres
SUPABASE_URL=https://[PROJECT_REF].supabase.co
SUPABASE_ANON_KEY=[YOUR_ANON_KEY]
```

## عند نقل المشروع إلى بيئة جديدة

1. قم بإنشاء نسخة احتياطية من قاعدة البيانات الحالية
2. انقل ملفات النسخة الاحتياطية من مجلد `backups/` إلى المشروع الجديد
3. في البيئة الجديدة، قم بإعداد Supabase وتحديث متغيرات البيئة
4. قم باستعادة قاعدة البيانات باستخدام سكربت الاستعادة

## ملاحظات مهمة

- تأكد من تحديث متغيرات البيئة الخاصة بقاعدة البيانات Supabase في البيئة الجديدة
- يتم تخزين جميع النسخ الاحتياطية في مجلد `backups/`
- النظام يدعم استرجاع البيانات تلقائيًا عند اكتشاف قاعدة بيانات جديدة فارغة
- يمكن استخدام لوحة تحكم Supabase للوصول إلى قاعدة البيانات مباشرة ومراقبة أدائها